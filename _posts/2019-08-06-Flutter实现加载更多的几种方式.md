---
layout:     post
title:      Flutter实现加载更多的几种方式
subtitle:   一直觉得加载更多的方式实现的很low，在此试图找到一些高级的实现方式
date:       2019-08-06
author:     Tristan
header-img: img/post-bg-flutter-loadmore.jpg
catalog: true
tags:
    - 加载更多
    - Flutter
    
---

1. 最基本也是最简单的一种实现方式是：判断当ListView的构造器在开始构造最后一条布局的时候，将此布局替换为“加载更多”的布局。

滑到列表底部，此时“加载更多”的布局便会显示，但是这里只是完成了第一步工作，因为真正加载更多数据的能力还没有的。

接下来，还需要在构造“加载更多”布局时，触发加载更多的数据方法。

注意，加载更多的方法不能即可生效，因为这里涉及到一个知识点，正在页面渲染时不能触及页面计算，所以此时还不能直接调用setState()用于加载更多，但我们可以通过延时等待页面渲染完成后再去操作。

这样，一个最基本的加载更多就实现了。这是一般加载更多的实现方式，也是native端如RecyclerView惯用的一种方式。这种方式可以实现功能，但是觉得还是有点低级。

```
class _MyHomePageState extends State<MyHomePage> {
  
  var count = 10;
  
  void loadMore() {
    Future.delayed(Duration(seconds: 2), () {
      setState(() {
        count += 10;
      });
    });
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      width: MediaQuery.of(context).size.width,
      child: ListView.builder(
        itemCount: count + 1,
        itemBuilder: _buildItem,
      ),
    );
  }

  Widget _buildItem(BuildContext context, int index) {
    if (index == count) {
      loadMore();
      return Container(
        width: MediaQuery.of(context).size.width,
        height: 80,
        child: Center(child: Text('正在加载...'),),
      );
    }
    return Container(
      width: MediaQuery.of(context).size.width,
      height: 80,
      child: Center(child: Text(index.toString(), style: TextStyle(color: Colors.white),),),
      decoration: BoxDecoration(
          border: Border(bottom: BorderSide(width: 1, color: Colors.white))
      ),
    );
  }

}
```
