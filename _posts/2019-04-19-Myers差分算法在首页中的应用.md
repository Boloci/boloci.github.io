---
layout:     post
title:      Myers差分算法在首页中的应用
subtitle:   从DiffUtil到Myers差量分析算法
date:       2019-04-19
author:     Tristan
header-img: img/post-bg-diff.jpg
catalog: true
tags:
    - DiffUtil
    - Myers
    - RecyclerView
    
---

## 背景
> **首页列表变量更新**，首页的上半身是个列表，列表根据变化内容刷新是必要的；但如果全量更新，则会产生不必要的性能损耗。`通常，用户的每多一次下拉刷新，首页区块都无需更新。`<br/>
> **搭建基础diff工具类**，diff的应用场景很广泛，两组字符串、两个列表之间有何变化都可能需要做diff分析，平台有必要搭建这样一个不受限于业务和具体UI控件的工具类供业务方使用。

## Diff工具类
Android中的diff工具类已经存在，比如下面两个：
- **DiffUtil**，用于比较两个数据集，寻找出旧数据集->新数据集的最小变化量。
    
    它的出现满足了数据集变量更新的诉求，并填补了RecyclerView的以下缺陷：
    > * 如果使用`notifyDataSetChanged()`全量更新数据，性能则会变差，同时变更动画将失效
    > * 如果使用`notifyItemRangeXxx()`变量更新数据，成本则会增大，因为业务层需要计算出变更的数据项
    
- **AsyncListDiffer**，它是DiffUtil的进化版，在后台线程使用DiffUtil计算diff的最小量，同时又在主线程中将更新操作的最小量分发给ListUpdateCallback，以完成数据更新，从而弥补了DiffUtil的缺陷。

那么已经有了如此好的工具，我们直接用于首页列表的diff可不可以呢？
> 答案是可以的；但是有些许不完美的地方，它内部引用了RecyclerView，与View的耦合度变高了

于此，我们为了更好地探索DiffUtil的实现机制和优化DiffUtil的瑕疵，想自己写一个不与View层耦合的diff工具类。为了达到此目标，我们先得从DiffUtil的算法开始。

## Myers差分算法
> 它是DiffUtil的核心算法
> 也是Git生成diff的算法

### Myers简介
> 1. 一种diff算法
> 2. 实现了最小的改动

### Myers算法解析
推导
> 图形解释

### “直观”是Myers的特性
> 1. Git生成diff为什么会用到Myers
### 首页列表的diff

