---
layout:     post
title:      用Flutter实现一个复杂页面
subtitle:   Flutter从入门到放弃
date:       2019-04-22
author:     Tristan
header-img: img/post-bg-flutter.png
catalog: true
tags:
    - Flutter
    - 首页
    
---

## 背景
Flutter作为全新跨平台应用框架，在页面渲染和MD开发上优势明显，可谓是业界一枝独秀。正好最近有这样的一个机会学习Flutter开发，我们便尝试用它开发一个MD风格的复杂页面，来比较跟原生应用开发的优势。也是想通过对新框架的学习探索，找到适合自身应用的框架。

## 页面展示
首页是整个应用里边交互最为复杂的一个页面了，它集合了各种滑动方式，包括：纵向滑动、横向滑动、嵌套滑动；同时，也集合了各种动效，包括：下拉刷新、上拉加载、头图视差、二级吸顶、回到顶部、横向Banner和纵向News轮播等。
<div style="color: #f00;"><img src="../../../../img/post-flutter-1.jpeg" width="33%" style="display: inline-block; border: 2px solid #000000; margin: 0; padding: 0;"/><img src="../../../../img/post-flutter-2.jpeg" width="33%" style="display: inline-block; border: 2px solid #000000; margin-left: 0.5%; margin-right: 0.5%; margin: 0; padding: 0;"/><img src="../../../../img/post-flutter-3.jpeg" width="33%" style="display: inline-block; border: 2px solid #000000; margin: 0; padding: 0;"></div>

## 开发历程
- 搭建了开发环境，新建flutter module并学习dart语法
- 调研用Flutter实现`CoordinatorLayout`的方案
- 实现了首页`主框架`的demo搭建，目前同样遇到了滑动冲突的问题，在调研解决方案
- 解决了`滑动冲突`的问题，并集成了下拉刷新能力
- 完成了各区块和feed流的`静态UI`内容，目前剩余feed流加载更多和负二楼动效
- 实现首页feed流的`加载更多`功能

## 技术点
#### 两级吸顶

```js
SliverAppBar(
  leading: null,
  /**
   * 如果没有leading，automaticallyImplyLeading为true，就会默认返回箭头
   * 如果 没有leading 且为false，空间留给title
   * 如果有leading，这个参数就无效了
   */
  automaticallyImplyLeading: false,
  centerTitle: true, //标题是否居中
  elevation: 1, //阴影的高度
  forceElevated: false, //是否显示阴影
  backgroundColor: bgColor, //背景颜色
  brightness: brightness, //黑底白字，light 白底黑字
  textTheme: TextTheme(), //字体样式
  primary: false, // appbar是否显示在屏幕的最上面，为false是显示在最上面，为true就显示在状态栏的下面
  titleSpacing: 0, //标题两边的空白区域
  expandedHeight: HEADER_HEIGHT, //默认高度是状态栏和导航栏的高度，如果有滚动视差的话，要大于前两者的高度
  floating: false, //滑动到最上面，再滑动是否隐藏导航栏的文字和标题等的具体内容，为true是隐藏，为false是不隐藏
  pinned: true, //是否固定导航栏，为true是固定，为false是不固定，往上滑，导航栏可以隐藏
  snap: false, // 只跟floating相对应，如果为true，floating必须为true，也就是向下滑动一点儿，整个大背景就会动画显示全部，网上滑动整个导航栏的内容就会消失
  bottom: PreferredSize(
    child: Header(offset: _offset, cityName: "北京", onOffsetChangeListener: _onOffsetChangeListener,),
    preferredSize: Size(screenWidth, 15),
  ),
),
SliverPersistentHeader(
  delegate: _SliverColumnDelegate(
    Column(
      children: widget.sections,
    ),
  )
),
SliverPersistentHeader(
  pinned: true,
  delegate: _SliverTabBarDelegate(
    TabBar(
      controller: tabController,
      labelPadding: EdgeInsets.fromLTRB(10, 0, 10, 0),
      labelColor: Color(0xff1A1A1A),
      unselectedLabelColor: Color(0xff1A1A1A),
      labelStyle: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
      unselectedLabelStyle: TextStyle(fontSize: 15, fontWeight: FontWeight.bold),
      isScrollable: true,
      tabs: widget.tabs,
      indicatorWeight: 5,
      indicator: UnderlineTabIndicator(
        borderSide: BorderSide(
          color: Color(0xffEF4A45),
          style: BorderStyle.solid,
          width: 4,
        ),
        insets: EdgeInsets.only(bottom: 5, left: 13, right: 13),
      ),
    )
  ),
),
```

#### 头图动画

    

#### 模块自己管理

    

#### 滑动冲突

    

#### 加载更多

    

## 参考文档
